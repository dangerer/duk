<!DOCTYPE html>
<html>
  <head>
    <title>FileWriter Example</title>
    <script type="text/javascript" charset="utf-8" src="cordova-2.0.0.js"></script>
    <script type="text/javascript" charset="utf-8">
	 var file = {
                writer: { available: false },
                reader: { available: false }
            };
	 var user_login = "";
	 var user_password = "";
	 var DOMAIN = "http://gtn02.gtn-solutions.com/moodle20/login/index.php";
/*	 var elementText = document.getElementById('text');
	 elementText.innerHTML = "";	 
	 var elementText = document.getElementById('content');
	 elementText.innerHTML = "";	/**/ 
    // Wait for Cordova to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);

	function onDeviceReady(){
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFSonDevice, fail);
	}
	function exists(){
//		var elementx = document.getElementById('files');
//		elementx.innerHTML = "found";
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFSExists, fail);
	}
	function gotFSExists(fileSystem){
		fileSystem.root.getFile("readme.txt", null, gotFileEntryExists, fail);
	}	
	function gotFileEntryExists(fileEntry){
		fileEntry.file(gotFile, fail);
	}
	function gotFile(file){
		 readAsText(file);
	}
	function readAsText(file) {
//		var elementText = document.getElementById('text');
//		elementText.innerHTML = "in readAsText";
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            console.log("Read as text");
            console.log(evt.target.result);
			var textArray  = evt.target.result.split(",");
			var message = document.getElementById('text');
			message.innerHTML = 'Please wait. Connecting.';
			user_login = textArray[0];
			user_password = textArray[1];
			var input_login = document.getElementById('username');
			input_login.value = user_login;
			var input_password = document.getElementById('password');
			input_password.value = user_password;
			//document.forms["login_form"].submit(); 
			document.getElementById('login_form').submit();
		};
        reader.readAsText(file);
		/*user_login = textArray[0];
		user_password = textArray[1];
		domain = textArray[2]; /**/
    }

	function create(){
		var element = document.getElementById('content');
		element.innerHTML = '<form name="login">' + 
                            '<input name="username" type="text" size="20" maxlength="30">' + 
                            '<input name="password" type="text" size="20" maxlength="20">' + 
                            '<input name="submit" type="button" value="Login" onClick="getInfo()">' + 
                            '</form>';
	}
    function gotFS(fileSystem) {
        fileSystem.root.getFile("readme.txt", {create: true, exclusive: false}, gotFileEntry, fail);
    }
	 function gotFSonDevice(fileSystem) {
        fileSystem.root.getFile("readme.txt", {create: false, exclusive: false}, exists, create);
    }

    function gotFileEntry(fileEntry) {
        fileEntry.createWriter(gotFileWriter, fail);
    }

    function gotFileWriter(writer) {
		writer.write(document.login.username.value+","+document.login.password.value+","+DOMAIN);
		alert(document.login.username.value);
		document.login_form.username.value = document.login.username.value;
		document.login_form.password.value = document.login.password.value;
		document.getElementById('login_form').submit();
		//window.location.href = DOMAIN;
    }

    function fail(error) {
		alert("Fail: " + error.code);
    }

	function getInfo(){
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
	}
    </script>
  </head>
  <body>
    <div id="content">
    </div>
    <div id="text">
    </div>
	<form style="display:none;" name="login_form" id="login_form" action="http://gtn02.gtn-solutions.com/moodle20/login/index.php" method="post">
		username <input type="text" size="100" value="" name="username" id="username"><br>
		password <input type="password" size="100" value="" name="password" id="password"><br>
		<input type="submit" value="submit">
	</form>
  </body>
</html>



